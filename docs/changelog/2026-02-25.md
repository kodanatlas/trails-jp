# 作業ログ 2026-02-25

## 実施内容

### 1. イベントページ: 鈴アイコン補足
- イベントページ冒頭にベルアイコン付きの補足文を追加
- 「🔔更新 が付いている大会はJOYの更新履歴に掲載されています」

### 2. GPS追跡: マーカー表示修正
- 選手の丸+氏名が消えていたバグを修正
- 原因: `marker.getElement().style.display = "block"` が flex レイアウトを破壊
- 修正: `"block"` → `"flex"`

### 3. O-map登録フロー整備
- 「アップロード」→「O-map登録」にリネーム（ヘッダー、モバイルメニュー含む）
- 地図データベース（MapBrowser）にO-map登録ボタン追加
- O-map画像バリデーション追加（長辺2000px以上必須、写真排除）

### 4. Supabase Auth 導入
- メールOTP認証を実装（signInWithOtp / verifyOtp）
- ユーザー名（display_name）をuser_metadataに保存
- メールテンプレートをカスタマイズ（日本語、8桁OTPコード表示）
- Site URL / Redirect URLsを本番URLに設定

### 5. JOYイベント座標マッチング
- JOY各大会ページからLeaflet.js座標を抽出（438/573件）
- O-map↔イベント紐づけ: bounds + 3km圏内マッチ（`map-event-matcher.ts`）
- 架空のsampleEventsを完全削除
- 日次Cronで座標未取得イベントを50件/日ずつ補完

### 6. サンプルデータ表記
- 地図データベースの8テレインに「サンプル」バッジ追加
- サイドバー上部に注意バナー表示
- 詳細ページにもサンプル表記

### 7. リスト/カレンダー切替のモバイル表示修正
- タブが横幅いっぱいに広がる問題を `w-fit` で修正

### 8. サイト下部ページ作成
- 「このサイトについて」(/about) - サイト概要・機能紹介・免責事項
- 「お問い合わせ」(/contact) - Formspreeフォーム（→ kodan1126@gmail.com）

## 変更ファイル一覧

### 新規作成
- `src/lib/supabase.ts`
- `src/lib/map-event-matcher.ts`
- `src/app/about/page.tsx`
- `src/app/contact/page.tsx`
- `src/app/contact/ContactForm.tsx`
- `scripts/enrich-coordinates.mjs`
- `.env.local`

### 主要変更
- `src/components/AuthGuard.tsx` - Supabase Auth対応（複数回リライト）
- `src/components/Header.tsx` - O-map登録リンク追加
- `src/app/events/page.tsx` - ベルアイコン補足文
- `src/app/events/EventList.tsx` - タブ幅修正
- `src/app/maps/MapBrowser.tsx` - 登録ボタン、サンプル表記
- `src/app/maps/[id]/page.tsx` - JOYイベントマッチング、サンプル表記
- `src/app/upload/UploadWizard.tsx` - O-mapリネーム、画像バリデーション
- `src/app/tracking/[eventId]/TrackingView.tsx` - マーカー display 修正
- `src/lib/scraper/events.ts` - 座標抽出機能追加
- `src/lib/sample-data.ts` - sampleEvents削除、isSample追加
- `src/types/map.ts` - isSample フィールド追加
- `src/data/events.json` - 座標データ付与
